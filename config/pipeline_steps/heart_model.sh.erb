#!/bin/bash -l
#SBATCH -N 1
#SBATCH --ntasks-per-node=1
#SBATCH --time=00:02:00
#SBATCH -A <%= grant_id %>
#SBATCH -p plgrid
#SBATCH --output /net/archive/groups/plggeurvalve/slurm_outputs/slurm-%j.out
#SBATCH --error /net/archive/groups/plggeurvalve/slurm_outputs/slurm-%j.err

## Change to the directory where sbatch was called
cd $SCRATCHDIR

## Copy the required compiled library file structure over
cp -r $PLG_GROUPS_STORAGE/plggeurvalve/0dmodel-master-5f563eaea47ed363dc9378447ba39b870884f1a2/model/Linx64 .

## Copy estimated patient-specific parameters
<%= stage_in :estimated_parameters, '0DModel_input.csv' %>

module load plgrid/apps/matlab/R2016b
matlab -r "addpath('$PLG_GROUPS_STORAGE/plggeurvalve/0dmodel-master-5f563eaea47ed363dc9378447ba39b870884f1a2/model');op=Launch0D(-1,'0DModel_input.csv');disp(op);exit;"

<%= stage_out 'Outfile.csv' %>
<%= stage_out 'Flow.png' %>
<%= stage_out 'Press.png' %>
<%= stage_out 'PVol.png' %>
<%= stage_out 'Vol.png' %>

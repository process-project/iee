image: ruby:2.3

services:
  - postgres

variables:
  POSTGRES_DB: vapor_test
  POSTGRES_USER: vapor
  POSTGRES_PASSWORD: ""

cache:
  paths:
  - vendor/

test:
  script:
  - apt-get update -qy
  - apt-get install -y nodejs
  - cp config/database.yml.gitlab-ci config/database.yml
  - bundle install --path vendor
  - bundle exec rake db:create RAILS_ENV=test
  - bundle exec rake test
